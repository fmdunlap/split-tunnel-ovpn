# Split Tunnel OpenVPN Package

The `split-tunnel-ovpn` package is designed to configure and manage a split-tunneling setup with OpenVPN. It allows you to route traffic for specific domains or IP addresses through the VPN while allowing other traffic to go through your regular internet connection.

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](https://opensource.org/licenses/MIT)

## Prerequisites

- OpenVPN
- Go (for building the `subfinder` tool)
- `bind` package (for DNS resolution)

## Installation

1. Install the package using your preferred package manager (e.g., `pacman`, `apt`, `yum`).

```
# For Arch-based systems
sudo pacman -U split-tunnel-ovpn-1.0.0-1-any.pkg.tar.zst

# For other systems
# TODO
```

2. Run the configuration script to set up the necessary files and credentials.

```
sudo split-tunnel-ovpn-configure
```

The script will prompt you to provide the following:

- Path to your CA certificate
- Path to your TA (HMAC) key
- Path to your `userpass` file (containing OpenVPN credentials)
- Path to a file containing IP addresses to exclude from the VPN (optional)
- Path to a file containing target domains to route through the VPN (optional)
- IP address and port of your VPN server

3. After the configuration is complete, enable and start the timer that updates the list of IP addresses and subdomains.

```
sudo systemctl enable split-tunnel-ovpn-subdomains.timer
sudo systemctl start split-tunnel-ovpn-subdomains.timer
```

## Usage

To start the OpenVPN connection with the split-tunneling configuration, run:

```
sudo split-tunnel-ovpn-start
```

This command will start the OpenVPN service with the `config.ovpn` file generated by the package.

## Directory Structure

```
split-tunnel-ovpn-package/
├── usr/
│   └── local/
│       └── bin/
│           ├── split-tunnel-ovpn-generate.sh
│           ├── split-tunnel-ovpn-configure.sh
│           ├── split-tunnel-ovpn-route-up.sh
│           └── split-tunnel-ovpn-start.sh
├── etc/
│   └── split-tunnel-ovpn/
│       ├── config.ovpn
│       ├── data/
│       │   ├── exclude_ips.txt
│       │   ├── ip_addresses.txt
│       │   └── target_domains.txt
│       └── creds/
├── etc/
│   └── systemd/
│       └── system/
│           ├── split-tunnel-ovpn-subdomains.service
│           └── split-tunnel-ovpn-subdomains.timer
├── package.sh
├── PKGBUILD
├── README.md
├── .gitignore
└── VERSION
```

## How It Works

1. The `split-tunnel-ovpn-generate.sh` script reads the target domains from the `target_domains.txt` file and the excluded IP addresses from the `exclude_ips.txt` file.
2. For each target domain, it finds subdomains using the `subfinder` tool and resolves their IP addresses using `dig`.
3. The resolved IP addresses, excluding the ones specified in `exclude_ips.txt`, are written to the `ip_addresses.txt` file.
4. The `split-tunnel-ovpn-subdomains.timer` runs the `split-tunnel-ovpn-generate.sh` script every 8 hours to update the list of IP addresses.
5. When the OpenVPN connection is established, the `split-tunnel-ovpn-route-up.sh` script reads the IP addresses from `ip_addresses.txt` and adds routes for each IP address through the VPN interface (`tun0`).

## Contributions

Contributions to the project are welcome! If you find any issues or have suggestions for improvements, please open an issue or submit a pull request on the project's GitHub repository.